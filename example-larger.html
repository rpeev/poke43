<!DOCTYPE html>

<html lang="en" class="light sans-serif">
  <head>
    <meta charset="utf-8" />

    <title>Poke43 - larger example</title>

    <link rel="stylesheet" href="https://unpkg.com/peek42@latest/dist/peek42.css" />
      <link rel="stylesheet" id="peek42DarkCss" />
    <link rel="stylesheet" href="https://unpkg.com/poke43@latest/poke43.css" />
      <link rel="stylesheet" id="poke43DarkCss" />

    <style>
.light {
  background: #f5f5f5;
  color: black;
}

.dark {
  background: black;
  color: #bdb76b;
}

.dark a {
  color: #65b042;
}

.sans-serif {
  font-family: Avenir, sans-serif;
}

#poke .poke43-editor {
  height: 70vh;
  font-family: Monofur, monospace;
  font-size: 1.3em;
}

#poke .poke43-keyboard {
  top: 50vh;
  right: 4em;
  opacity: 1;
}
    </style>

    <script src="https://unpkg.com/apivis@latest/dist/apivis.browser.js"></script>
    <script src="https://unpkg.com/peek42@latest/dist/peek42.browser.js"></script>
      <!-- Conform to the old peek42 interface until poke43 gets updated -->
      <script>Object.assign(window, {
        Peek42: {}
      });</script>
    <script src="https://unpkg.com/hammerjs@latest/hammer.js"></script>
    <script src="https://unpkg.com/@emmetio/expand-abbreviation@latest/dist/expand-full.js"></script>
    <script src="https://unpkg.com/poke43@latest/emmet-extract-abbreviation.js"></script>
    <script src="https://unpkg.com/poke43@latest/emmet-field-parser.js"></script>
    <script src="https://unpkg.com/poke43@latest/poke43.js"></script>

    <script>(() => { 'use strict';
const {Poke} = poke43;

function pathParts(path) {
  let href = new URL(path).href;
  let iLastSlash = href.lastIndexOf('/');

  return {
    name: href.slice(iLastSlash + 1),
    location: href.slice(0, iLastSlash)
  };
}

function loadingMessage(path) {
  let {name, location} = pathParts(path);

  return `Loading...\n\n${name || 'index'}\nat ${location}`;
}

function errorMessage(err, path) {
  let message = (err instanceof TypeError) ?
    'Network error (cross-domain request?)' :
    String(err);
  let {name, location} = pathParts(path);

  return `${message}\n\n${name || 'index'}\nat ${location}`;
}

function statusErrorMessage(res) {
  let {name, location} = pathParts(res.url);

  return `${res.statusText} (${res.status})\n\n${name || 'index'}\nat ${location}`;
}

async function loadFile(poke, path) {
  poke._editor.content = loadingMessage((new URL(path, window.location.href)).href);

  try {
    let res = await fetch(path);

    poke._editor.content = (res.ok) ?
      await res.text() :
      statusErrorMessage(res);
  } catch (err) {
    poke._editor.content = errorMessage(err, path);
  }
}

document.addEventListener('DOMContentLoaded', async () => {
  let peek42DarkCss = document.getElementById('peek42DarkCss');
  let peek42DarkCssUrl = 'https://unpkg.com/peek42@latest/dist/peek42-dark.css';
  let poke43DarkCss = document.getElementById('poke43DarkCss');
  let poke43DarkCssUrl = 'https://unpkg.com/poke43@latest/poke43-dark.css';
  let switchTheme = document.getElementById('switchTheme');
  let loadContent = document.getElementById('loadContent');
  let clearEditor = document.getElementById('clearEditor');
  let poke = new Poke(document.getElementById('poke'));
  let contentPath = 'https://unpkg.com/poke43@latest/poke43.js';

  switchTheme.addEventListener('click', () => {
    let html = document.documentElement;
    let pageClasses = html.classList;

    if (pageClasses.contains('light')) {
      pageClasses.remove('light');
      pageClasses.add('dark');
      peek42DarkCss.setAttribute('href', peek42DarkCssUrl);
      poke43DarkCss.setAttribute('href', poke43DarkCssUrl);
      switchTheme.textContent = 'Light Theme';
    } else {
      pageClasses.remove('dark');
      pageClasses.add('light');
      peek42DarkCss.removeAttribute('href');
      poke43DarkCss.removeAttribute('href');
      switchTheme.textContent = 'Dark Theme';
    }
  });

  loadContent.addEventListener('click', async () => {
    await loadFile(poke, contentPath);
  });

  clearEditor.addEventListener('click', () => {
    poke._editor.content = '';
  });

  await loadFile(poke, contentPath);
});
    })();</script>
  </head>

  <body>
<h1 id="about">Poke43 - larger example [<a href="./index.html">Index</a>]
  <button id="switchTheme">Dark Theme</button>
  <button id="loadContent">Load Content</button>
  <button id="clearEditor">Clear Editor</button>
</h1>

<div id="poke">
</div>
  </body>
</html>
